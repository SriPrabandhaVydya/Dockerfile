pipeline {
  agent any
  stages {
    stage('Build') {
      steps {
        script {
          // Replace 'docker-hub' with your Docker Hub credentials ID
          docker.withRegistry('https://registry.hub.docker.com', 'docker-hub') {
            def imageTag = "${env.GIT_COMMIT}" // Assuming GIT_COMMIT is set by Jenkins
            docker.build("sriprabandhavydya/jenkinsdemo:${imageTag}", ".")
          }
        }
      }
    }
    
    stage('Publish to DockerHub') {
      steps {
        script {
          docker.withRegistry('https://registry.hub.docker.com', 'docker-hub') {
            def imageTag = "${env.GIT_COMMIT}" // Assuming GIT_COMMIT is set by Jenkins
            docker.image("sriprabandhavydya/jenkinsdemo:${imageTag}").push()
          }
        }
      }
    }
  }
}
